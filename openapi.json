{"openapi":"3.1.0","info":{"title":"DCMG","version":"0.1.0"},"paths":{"/api/scm/upload_imgzip_with_usb":{"get":{"tags":["SCM"],"summary":"Upload Imgzip With Usb","description":"This function uploads the image file to the USB drive and returns a generator that yields the progress of the upload.\n\n## args:\n\n- **image**: The name of the image file.\n\n## return\n\n- **upload_progress**: The progress of the upload.","operationId":"upload_imgzip_with_usb_api_scm_upload_imgzip_with_usb_get","parameters":[{"name":"image","in":"query","required":true,"schema":{"type":"string","title":"Image"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/scm/upload_imgzip_chunked":{"post":{"tags":["SCM"],"summary":"Upload Imgzip Chunked","description":"This function chunks the uploaded image file and returns a generator that yields the progress of the upload.\n\n## args:\n\n- **image**: The ZIP file containing the images.Example structure:<br/>\n    myzip.zip<br/>\n    ├── folder_name/<br/>\n    │   ├── 1.jpg<br/>\n    │   └── 2.png<br/>\n\n## return\n- **upload_progress**: The progress of the upload.","operationId":"upload_imgzip_chunked_api_scm_upload_imgzip_chunked_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_upload_imgzip_chunked_api_scm_upload_imgzip_chunked_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/scm/run_job":{"post":{"tags":["SCM"],"summary":"Run Job","description":"This endpoint is used to run a task with an image ZIP file.\n\n## args:\n\n- **images_dir**: The directory containing the images.<br/>\n- **run_id**: The ID of the task.<br/>\n- **job_name**: The name of the task.<br/>\n- **gsd_cm**: The ground sampling distance in centimeters.<br/>\n- **row_spacing_cm**: The row spacing in centimeters.<br/>\n- **plant_spacing_cm**: The plant spacing in centimeters.<br/>\n- **ridge_spacing_cm**: The ridge spacing in centimeters.<br/>\n- **big_threshold**: The threshold for big objects in the image.<br/>\n- **small_threshold**: The threshold for small objects in the image.\n\n## return\n\n- **job**: The details of the task.","operationId":"run_job_api_scm_run_job_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/JobSettings"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/scm/get_job_details":{"get":{"tags":["SCM"],"summary":"Get Job Details","description":"This endpoint is used to get the details of a task.\nThe task details include the input parameters, the progress, and the list of detected images.\n\n## args:\n\n- **job_id**: The ID of the task.\n\n## return\n- **job**: The details of the task.","operationId":"get_job_details_api_scm_get_job_details_get","parameters":[{"name":"job_id","in":"query","required":true,"schema":{"type":"integer","title":"Job Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/scm/get_job_logs":{"get":{"tags":["SCM"],"summary":"Get Job Logs","description":"This endpoint is used to get the logs of a task.\n\n## args:\n\n- **job_id**: The ID of the task.\n\n## return\n- **logs**: The logs of the task.","operationId":"get_job_logs_api_scm_get_job_logs_get","parameters":[{"name":"job_id","in":"query","required":true,"schema":{"type":"integer","title":"Job Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/scm/job_uploaded":{"put":{"tags":["SCM"],"summary":"Update Job Status","description":"This endpoint is used to update the status of a task.\n\n## args:\n\n- **job_id**: The ID of the task.\n\n## return\n- **success**: A boolean value indicating whether the status is updated successfully or not.","operationId":"update_job_status_api_scm_job_uploaded_put","parameters":[{"name":"job_id","in":"query","required":true,"schema":{"type":"integer","title":"Job Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/scm/get_job_status":{"get":{"tags":["SCM"],"summary":"Get Job Status","description":"This endpoint is used to query the status of a task.\n\n## args:\n\n- **job_id**: The ID of the task.\n\n## return\n- **is_running**: A boolean value indicating whether the task is running or not.","operationId":"get_job_status_api_scm_get_job_status_get","parameters":[{"name":"job_id","in":"query","required":true,"schema":{"type":"integer","title":"Job Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JobRunner"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/scm/get_jobs":{"get":{"tags":["SCM"],"summary":"Get Jobs","description":"This endpoint is used to get a list of all tasks.\n\n## args:\n\n- **page**: The page number to retrieve, default: 1\n- **limit**: The number of tasks to retrieve per page, default: 10\n- **status**: The status of the tasks to retrieve, comma-separated, default: None (all)\n  - **waiting**: The task is waiting to be processed.\n  - **running**: The task is currently running.\n  - **completed**: The task has completed.\n  - **failed**: The task has failed.\n  - **uploaded**: The task has been uploaded.\n- **job_name**: The name of the tasks to retrieve, default: None (all)\n\n## return\n- **jobs**: A list of all tasks.","operationId":"get_jobs_api_scm_get_jobs_get","parameters":[{"name":"page","in":"query","required":false,"schema":{"type":"integer","default":1,"title":"Page"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":10,"title":"Limit"}},{"name":"status","in":"query","required":false,"schema":{"type":"string","title":"Status"}},{"name":"job_name","in":"query","required":false,"schema":{"type":"string","title":"Job Name"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/scm/remove_job_all_res_by_id":{"delete":{"tags":["SCM"],"summary":"Remove Job All Res By Id","description":"This endpoint is used to remove a task and all its related resources (images, logs, etc.).\n\n## args:\n\n- **job_id**: The ID of the task.\n\n## return\n\n- **success**: A boolean value indicating whether the task is removed successfully or not.","operationId":"remove_job_all_res_by_id_api_scm_remove_job_all_res_by_id_delete","parameters":[{"name":"job_id","in":"query","required":true,"schema":{"type":"integer","title":"Job Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/scm/update_job_progress":{"get":{"tags":["SCM"],"summary":"Update Job Progress","description":"This endpoint is used to update the progress of a task.\n\nonly used by the container callback to update the progress.\n\n## args:\n\n- **run_id**: The ID of the task.\n- **percent**: The progress of the task in percentage.\n\n## return\n- **progress**: The progress of the task.","operationId":"update_job_progress_api_scm_update_job_progress_get","parameters":[{"name":"run_id","in":"query","required":true,"schema":{"type":"string","title":"Run Id"}},{"name":"percent","in":"query","required":true,"schema":{"type":"number","title":"Percent"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/scm/save_report":{"post":{"tags":["SCM"],"summary":"Save Report","description":"This endpoint is used to save the report of a task.\n\nThe report is a JSON object containing the detected images and their properties.\n\nonly used by the container callback to save the report.","operationId":"save_report_api_scm_save_report_post","requestBody":{"content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Data"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/odm/get_odm_jobs":{"get":{"tags":["ODM"],"summary":"Get Odm Jobs","description":"## Get ODM tasks List\nThe endpoint returns a list of ODM tasks.\n\n### This endpoint performs the following operations:\n1. Fetches a list of RSDM jobs from the database\n2. Filters running jobs if `only_running` is set to `True`\n3. Returns the filtered list of jobs\n\n### Parameters\n- **page**: Page number (default: 1)\n- **limit**: Items per page (default: 1000)\n- **only_running**: Filter running jobs only (default: True)\n\n### State\n- **PENDING**: The job is waiting to be processed\n- **RUNNING**: The job is currently processing\n- **COMPLETED**: The job has completed successfully\n- **FAILED**: The job has failed\n- **CANCELED**: The job has been canceled by the user or system\n\n### Response\nReturns `List[OdmJobs]` with fields:\n- **run_id**: Job unique identifier\n- **odm_project_id**: Related project ID\n- **odm_job_name**: Human-readable job name\n- **odm_src_folder**: Data storage path\n- ...other fields...\n\n### Example\n```json\n[{\n  \"id\": 1,\n  \"odm_project_id\": 1,\n  \"odm_job_name\": \"test\",\n  \"odm_src_folder\": \"images/\",\n  \"odm_samplinge_time\": \"2025-08-17T09:04:40.311000\",\n  \"odm_image_count\": 56,\n  \"progress\": 0,\n  \"celery_task_id\": \"66ac0298-e3c0-4744-ae5c-62567f292ae0\",\n  \"update_at\": \"2025-08-17T17:00:41.479989\",\n  \"odm_task_id\": \"8671d618-6cd7-40ce-aba4-45e85eab19fb\",\n  \"run_id\": \"daccd58c51e94960\",\n  \"odm_job_type\": \"multispectral\",\n  \"odm_dest_folder\": \"E:\\python\\dcmg\\tmp\\1\\8671d618-6cd7-40ce-aba4-45e85eab19fb\",\n  \"odm_host\": \"http://192.168.3.194:7000/\",\n  \"odm_create_at\": \"2025-08-17T09:04:40.311000\",\n  \"state\": \"PENDING\",\n  \"err_msg\": null\n}]\n```","operationId":"get_odm_jobs_api_odm_get_odm_jobs_get","parameters":[{"name":"page","in":"query","required":false,"schema":{"type":"integer","default":1,"title":"Page"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":1000,"title":"Limit"}},{"name":"only_running","in":"query","required":false,"schema":{"type":"boolean","default":true,"title":"Only Running"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/odm/create_odm_job":{"post":{"tags":["ODM"],"summary":"Create Odm Job","description":"## Create ODM Task\nCreate a new ODM task and initiate the image processing pipeline.\n\n### This endpoint performs the following operations:\n1. Scans the specified folder for images matching the job type\n2. Validates that images are found; removes ODM task if none exist\n3. Creates a new RSDM job record in the database\n4. Initiates background task to copy images to the ODM server\n5. Returns the created job information\n\n### Parameters\n- **data (OdmJob)**: The ODM task configuration including folder path, project ID, task ID, and job type\n\n### Response:\nReturns `OdmJobs` with fields:\n- **run_id**: Job unique identifier\n- **odm_project_id**: Related project ID\n- **odm_job_name**: Human-readable job name\n- **odm_src_folder**: Data storage path\n- ...other fields...\n\n### Example\n```json\n{\n  \"id\": 1,\n  \"odm_project_id\": 1,\n  \"odm_job_name\": \"test\",\n  \"odm_src_folder\": \"images/\",\n  \"odm_samplinge_time\": \"2025-08-17T09:04:40.311000\",\n  \"odm_image_count\": 56,\n  \"progress\": 0,\n  \"celery_task_id\": \"66ac0298-e3c0-4744-ae5c-62567f292ae0\",\n  \"update_at\": \"2025-08-17T17:00:41.479989\",\n  \"odm_task_id\": \"8671d618-6cd7-40ce-aba4-45e85eab19fb\",\n  \"run_id\": \"daccd58c51e94960\",\n  \"odm_job_type\": \"multispectral\",\n  \"odm_dest_folder\": \"E:\\python\\dcmg\\tmp\\1\\8671d618-6cd7-40ce-aba4-45e85eab19fb\",\n  \"odm_host\": \"http://192.168.3.194:7000/\",\n  \"odm_create_at\": \"2025-08-17T09:04:40.311000\",\n  \"state\": \"PENDING\",\n  \"err_msg\": null\n}\n```\n\n### Raises\nHTTPException\n- **400**: Task already exists, not allowed to duplicate one, please check odm server.\n- **404**: No images found in the specified folder\n- **500**: Internal server error during job creation","operationId":"create_odm_job_api_odm_create_odm_job_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/OdmJob"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/odm/get_odm_state":{"get":{"tags":["ODM"],"summary":"Get Odm State","description":"## Get the current state of an ODM task.\n\nThis endpoint retrieves the current state of an ODM task.\n\n### Parameters\n- **project_id**: The project ID of the ODM task\n- **task_id**: The task ID of the ODM task\n\n### Response:\nReturns `OdmState` with fields:\n- **state**: The current state of the ODM task\n- **progress**: The progress of the ODM task (0-100)\n- **host**: The base URL of the ODM server\n- **error**: The error message if the job failed, otherwise null\n\n### Example\n```json\n{\n  \"state\": \"COMPLETED\",\n  \"progress\": 100,\n  \"host\": \"http://127.0.0.1:8000\",\n  \"error\": null\n}\n```","operationId":"get_odm_state_api_odm_get_odm_state_get","parameters":[{"name":"project_id","in":"query","required":true,"schema":{"type":"integer","title":"Project Id"}},{"name":"task_id","in":"query","required":true,"schema":{"type":"string","title":"Task Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OdmState"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/odm/cancel_odm_job":{"get":{"tags":["ODM"],"summary":"Cancel Odm Job","description":"## Cancel an ODM task that is pending, running, or waiting.\n\nThis endpoint attempts to cancel an ODM task by:\n1. Finding the job in the database using project_id and task_id\n2. Checking if the job is in a state that can be cancelled (pending, running, or waiting)\n3. Initiating the cancellation of the Celery task\n4. ODM server will remove the task\n5. Updating the job status in the database to canceled\n\n### Parameters\n- **project_id**: The project ID of the ODM task\n- **task_id**: The task ID of the ODM task\n\n### Response:\nReturns `OdmJobs` with fields:\n- **run_id**: Job unique identifier\n- **odm_project_id**: Related project ID\n- **odm_job_name**: Human-readable job name\n- **odm_src_folder**: Data storage path\n- ...other fields...\n\n### Raises:\n- **HTTPException:** Raises 404 if the job is not found\n- **HTTPException:** Raises 400 if the job is not in a state that can be cancelled (pending, running, or waiting)\n- **HTTPException:** Raises 500 if th job is not removed from the celery task or the odm server.","operationId":"cancel_odm_job_api_odm_cancel_odm_job_get","parameters":[{"name":"project_id","in":"query","required":true,"schema":{"type":"integer","title":"Project Id"}},{"name":"task_id","in":"query","required":true,"schema":{"type":"string","title":"Task Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/odm/remove_odm_job":{"get":{"tags":["ODM"],"summary":"Remove Odm Job","description":"### Remove an ODM task that is completed, failed, or canceled.\n\nThis endpoint attempts to remove an ODM task by:\n1. Finding the job in the database using project_id and task_id\n2. Checking if the job is in a state that can be removed (completed, failed, or canceled)\n3. Deleting the job from the database\n\n### Returns:\n- **None:** Returns 204 No Content if the job was successfully removed from the database\n\n### Raises:\n- **HTTPException:** Raises 404 if the job is not found\n- **HTTPException:** Raises 400 if the job is not in a state that can be removed (completed, failed, or canceled)","operationId":"remove_odm_job_api_odm_remove_odm_job_get","parameters":[{"name":"project_id","in":"query","required":true,"schema":{"type":"integer","title":"Project Id"}},{"name":"task_id","in":"query","required":true,"schema":{"type":"string","title":"Task Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/odm/generate_report":{"post":{"tags":["ODM"],"summary":"Generate Report","description":"### Save the ODM report for a completed ODM task.\n\nThis endpoint saves the ODM report for a completed ODM task by:\n1. Finding the job in the database using project_id and task_id\n2. Checking if the job is in a state that can have a report (completed)\n3. Saving the report to the database\n4. Updating the job status in the database to completed\n\n### Parameters\n- **project_id**: The project ID of the ODM task\n- **task_id**: The task ID of the ODM task\n- **orthophoto_tif**: The path to the orthophoto tif file\n\n### Returns:\n- **None:** Returns 204 No Content if the report was successfully saved to the database\n\n### Raises:\n- **HTTPException:** Raises 400 if the orthophoto tif file is not provided\n- **HTTPException:** Raises 404 if the orthophoto tif file is not found\n- **HTTPException:** Raises 404 if the job is not found","operationId":"generate_report_api_odm_generate_report_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/OdmGenRep"}}},"required":true},"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/odm/save_report":{"post":{"tags":["ODM"],"summary":"Save Report","description":"## Save the ODM report for a completed ODM task.\n\nThis endpoint saves the ODM report for a completed ODM task by:\n1. Finding the job in the database using project_id and task_id\n2. Checking if the job is in a state that can have a report (completed)\n3. Saving the report to the database\n4. Updating the job status in the database to completed\n\n### Parameters\n- **data** (OdmAlgoRep): The report data including:\n- **project_id** (int): The project ID associated with this report\n- **task_id** (str): The task ID associated with this report\n- **output_dir** (str): Directory where output files are stored\n- **log_file** (str): Path to the log file\n- **algo_name** (str): Name of the algorithm used (e.g., \"ndvi\")\n- **file_name** (str): Name of the orthophoto file\n- **area_mu** (float): Area measurement value\n- **report** (dict): Dictionary containing report statistics including:\n    - min, max, mean, stddev values\n    - output files list\n    - classification count data\n\n### Returns:\n- **OdmReport:** Returns the saved report object","operationId":"save_report_api_odm_save_report_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/OdmAlgoRep"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/odm/get_report_detail":{"get":{"tags":["ODM"],"summary":"Get Report Detail","description":"## Get the current state of an ODM report.\n\nThis endpoint retrieves the current state of an ODM report.\n\n### Parameters\n- **project_id**: The project ID of the ODM task\n- **task_id**: The task ID of the ODM task\n- **algo_name**: The name of the algorithm used to generate the report\n\n### Response:\nReturns `OdmReport`","operationId":"get_report_detail_api_odm_get_report_detail_get","parameters":[{"name":"project_id","in":"query","required":true,"schema":{"type":"integer","title":"Project Id"}},{"name":"task_id","in":"query","required":true,"schema":{"type":"string","title":"Task Id"}},{"name":"algo_name","in":"query","required":false,"schema":{"type":"string","default":"ndvi","title":"Algo Name"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/odm/get_reports":{"get":{"tags":["ODM"],"summary":"Get Reports","description":"## Get the list of ODM reports.\n\nThis endpoint retrieves the list of ODM reports.\n\n### Parameters\n- **page**: The page number to retrieve (default: 1)\n- **limit**: The number of records to retrieve (default: 1000)\n- **only_running**: Whether to only retrieve reports that are still running (default: True)\n\n### Returns:\n- **List[OdmReport]:** Returns a list of OdmReport objects","operationId":"get_reports_api_odm_get_reports_get","parameters":[{"name":"page","in":"query","required":false,"schema":{"type":"integer","default":1,"title":"Page"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":1000,"title":"Limit"}},{"name":"only_running","in":"query","required":false,"schema":{"type":"boolean","default":true,"title":"Only Running"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/odm/upload_report":{"post":{"tags":["ODM"],"summary":"Upload Report","description":"## Upload the ODM report to OSS and commit to online system.\n\nThis endpoint uploads the ODM report to OSS and commits the report information to the online system:\n1. Finding the report in the database using project_id, task_id, and algo_name\n2. Preparing environment variables for OSS upload\n3. Starting background task to upload report files to OSS\n4. Committing report metadata to the online system\n5. Updating the report status in the database to running\n\n### Parameters\n- **data** (UploadRepTask): The upload report task data including project_id, task_id, algo_name, and report_no\n- **token** (str, Header): Authentication token for ODM server\n- **cid** (str, Header): Client ID for ODM server\n- **db** (Session): Database session dependency\n\n### Returns:\n- **OdmReport:** Returns the updated report object with new celery task ID and running status\n\n### Raises:\n- **HTTPException:** Raises 404 if the report is not found\n- **HTTPException:** Raises 400 if the report is already uploaded\n\n### Process:\n1. Query database for the specified ODM report\n2. If report not found, raise 404 error\n3. Prepare environment variables for OSS upload and online commit\n4. Start Celery task to:\n   a. Upload report files to OSS with progress tracking\n   b. Commit report metadata to the online system\n5. Update report record with new Celery task ID and running status\n6. Commit changes to database\n7. Return updated report object\n\n### Background Task Steps:\nThe background task performs these operations:\n1. Download full report ZIP from ODM server\n2. Upload individual output files to OSS\n3. Upload full report ZIP to OSS\n4. Commit report information to online system with metadata\n5. Update database with final status","operationId":"upload_report_api_odm_upload_report_post","parameters":[{"name":"token","in":"header","required":true,"schema":{"type":"string","title":"Token"}},{"name":"cid","in":"header","required":true,"schema":{"type":"string","title":"Cid"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UploadRepTask"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/odm/cancel_upload_task":{"get":{"tags":["ODM"],"summary":"Cancel Upload Task","description":"## Cancel the ODM report upload task.\nThis endpoint cancels the ODM report upload task by:\n1. Finding the report in the database using project_id, task_id, and algo_name\n2. Checking if the report is running\n3. Aborting the Celery task associated with the report\n4. Updating the report status in the database to cancelled\n\n### Parameters\n- **project_id**: The project ID of the ODM task\n- **task_id**: The task ID of the ODM task\n- **algo_name**: The name of the algorithm used to generate the report\n- **db** (Session): Database session dependency\n\n### Returns:\n- **None:** Returns 204 No Content if the report upload task was successfully cancelled\n\n### Raises:\n- **HTTPException:** Raises 404 if the report is not found\n- **HTTPException:** Raises 400 if the report is not running. Cannot cancel.","operationId":"cancel_upload_task_api_odm_cancel_upload_task_get","parameters":[{"name":"project_id","in":"query","required":true,"schema":{"type":"integer","title":"Project Id"}},{"name":"task_id","in":"query","required":true,"schema":{"type":"string","title":"Task Id"}},{"name":"algo_name","in":"query","required":false,"schema":{"type":"string","default":"ndvi","title":"Algo Name"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/3dcm/jobs":{"post":{"tags":["3DCM"],"summary":"Create 3Dcm Job","description":"### Create a new VDCM job\n\nThis endpoint creates a new VDCM job by:\n1. Checking if a job with the same ID already exists\n2. Validating that the source file exists\n3. Creating destination folders for output\n4. Starting the reconstruction task in Celery\n5. Saving the job information to the database\n\n### Parameters:\n- **data**: Vdcm model containing job information including task ID and source path\n- **db**: Database session dependency\n\n### Special handling:\n- **no**: If not provided, a unique ID will be generated in the format PXXXXX_YY_SAMPLEBATCH_SAMPLE,\n  where XXXXX is a 5-digit number and YY is a 2-digit number\n- **taken_at**: If not provided, it will be set to the creation time of the source file\n\n### Returns:\n- **VdcmJobs**: The created job object with all details\n\n### Raises:\n- **HTTPException**: 400 error if task with same ID already exists\n- **HTTPException**: 400 error if source file does not exist","operationId":"create_3dcm_job_api_3dcm_jobs_post","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Vdcm"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"get":{"tags":["3DCM"],"summary":"Get Jobs","description":"### Retrieve VDCM jobs\n\nThis endpoint retrieves a list of VDCM jobs with pagination support:\n1. Queries the database for VDCM jobs\n2. Order results by ID in descending order (the newest first)\n3. Applies pagination using offset and limit\n4. Optionally filters to show only running jobs\n5. Updates upload progress from Celery tasks if available\n\n### Parameters:\n- **page**: Page number for pagination (default: 1)\n- **limit**: Number of items per page (default: 1000)\n- **only_running**: Flag to filter only running jobs (default: True)\n- **db**: Database session dependency\n\n### Returns:\n- **List[VdcmJobs]**: List of VDCM job objects matching the criteria\n\n### Upload Status:\n- If uploads is not null and State is COMPLETED and uploads.cloud_id > 0,\n  it indicates that the upload has been completed and there is no need to upload again.","operationId":"get_jobs_api_3dcm_jobs_get","parameters":[{"name":"page","in":"query","required":false,"schema":{"type":"integer","default":1,"title":"Page"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":1000,"title":"Limit"}},{"name":"only_running","in":"query","required":false,"schema":{"type":"boolean","default":true,"title":"Only Running"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/3dcm/jobs/{no}/progress":{"patch":{"tags":["3DCM"],"summary":"Update Job Progress","description":"### Update the progress of a VDCM job\n\nThis endpoint updates the progress percentage of a running VDCM job:\n1. Finds the job in the database using the task ID\n2. Validates that the job exists\n3. Updates the progress field with the provided percentage\n4. Commits the changes to the database\n\n### Parameters:\n- **no**: The ID of the task to update\n- **percent**: The progress of the task in percentage\n- **db**: Database session dependency\n\n### Returns:\n- **float**: The updated progress value rounded to 2 decimal places\n\n### Raises:\n- **HTTPException**: 404 error if task with specified ID does not exist","operationId":"update_job_progress_api_3dcm_jobs__no__progress_patch","parameters":[{"name":"no","in":"path","required":true,"schema":{"type":"string","title":"No"}},{"name":"percent","in":"query","required":true,"schema":{"type":"number","title":"Percent"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/3dcm/jobs/{no}/cancel":{"post":{"tags":["3DCM"],"summary":"Cancel Job By No","description":"### Cancel VDCM jobs\n\nThis endpoint cancels a running VDCM job:\n1. Finds the job in the database using the task ID\n2. Validates that the job exists\n3. Validates that the job is running\n4. Cancels the Celery task\n5. Updates the job state to canceled in the database\n\n### Parameters:\n- **no**: The ID of the task to cancel\n- **db**: Database session dependency\n\n### Returns:\n- **VdcmJobs**: The updated job object with the canceled state\n\n### Raises:\n- **HTTPException**: 404 error if task with specified ID does not exist\n- **HTTPException**: 400 error if task is not running or pending","operationId":"cancel_job_by_no_api_3dcm_jobs__no__cancel_post","parameters":[{"name":"no","in":"path","required":true,"schema":{"type":"string","title":"No"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/3dcm/jobs/{no}":{"delete":{"tags":["3DCM"],"summary":"Remove Job By No","description":"### Remove a VDCM job completely\n\nThis endpoint removes a VDCM job completely from the system:\n1. Finds the job in the database using the task ID\n2. Validates that the job exists\n3. Validates that the job is not running\n4. Removes all files associated with the job\n5. Deletes the job record from the database\n\n### Parameters:\n- **no**: The ID of the task to remove\n- **db**: Database session dependency\n\n### Returns:\n- **None**: Returns 204 No Content on successful removal\n\n### Raises:\n- **HTTPException**: 404 error if task with specified ID does not exist\n- **HTTPException**: 400 error if task is still running","operationId":"remove_job_by_no_api_3dcm_jobs__no__delete","parameters":[{"name":"no","in":"path","required":true,"schema":{"type":"string","title":"No"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/3dcm/jobs/{no}/upload":{"post":{"tags":["3DCM"],"summary":"Upload Report","description":"### Initiate report upload process for a completed VDCM job\n\nThis endpoint initiates the process of uploading a completed VDCM job's report:\n1. Validates that the job exists and is completed\n2. Creates or reuses an existing upload record\n3. Starts the upload task in Celery\n4. Resets upload-related fields for re-upload if applicable\n\n### Parameters:\n- **no**: The ID of the task to upload report for\n- **token**: Authentication token for API requests\n- **cid**: Client ID for API requests\n- **terminal_id**: Terminal ID for API requests\n- **terminal_type**: Terminal type for API requests\n- **db**: Database session dependency\n\n### Returns:\n- **VdcmUploads**: The upload task object with initial state\n\n### Raises:\n- **HTTPException**: 404 error if task doesn't exist\n- **HTTPException**: 400 error if task isn't completed\n- **HTTPException**: 400 error if upload is already in progress","operationId":"upload_report_api_3dcm_jobs__no__upload_post","parameters":[{"name":"no","in":"path","required":true,"schema":{"type":"string","title":"No"}},{"name":"token","in":"header","required":true,"schema":{"type":"string","title":"Token"}},{"name":"cid","in":"header","required":true,"schema":{"type":"string","title":"Cid"}},{"name":"terminal-id","in":"header","required":true,"schema":{"type":"string","title":"Terminal-Id"}},{"name":"terminal-type","in":"header","required":true,"schema":{"type":"string","title":"Terminal-Type"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"Body_upload_imgzip_chunked_api_scm_upload_imgzip_chunked_post":{"properties":{"image":{"type":"string","format":"binary","title":"Image"}},"type":"object","required":["image"],"title":"Body_upload_imgzip_chunked_api_scm_upload_imgzip_chunked_post"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"JobRunner":{"properties":{"status":{"$ref":"#/components/schemas/JobStatus"},"progress":{"type":"number","title":"Progress"},"run_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Run Id"}},"type":"object","required":["status","progress"],"title":"JobRunner","description":"The status of a job runner."},"JobSettings":{"properties":{"images_dir":{"type":"string","title":"Images Dir"},"run_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Run Id"},"job_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Job Name"},"gsd_cm":{"type":"number","title":"Gsd Cm","default":0.32},"row_spacing_cm":{"type":"number","title":"Row Spacing Cm","default":80.0},"plant_spacing_cm":{"type":"number","title":"Plant Spacing Cm","default":10.0},"ridge_spacing_cm":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Ridge Spacing Cm"},"big_threshold":{"type":"number","title":"Big Threshold","default":0.2},"small_threshold":{"type":"number","title":"Small Threshold","default":0.3}},"type":"object","required":["images_dir"],"title":"JobSettings","description":"The settings of a job."},"JobStatus":{"type":"string","enum":["waiting","running","completed","failed","uploaded"],"title":"JobStatus"},"JobType":{"type":"string","enum":["VIDEO","IMAGE"],"title":"JobType","description":"Enumeration for job types"},"OdmAlgoRep":{"properties":{"project_id":{"type":"integer","title":"Project Id"},"task_id":{"type":"string","title":"Task Id"},"output_dir":{"type":"string","title":"Output Dir"},"log_file":{"type":"string","title":"Log File"},"algo_name":{"type":"string","title":"Algo Name"},"file_name":{"type":"string","title":"File Name"},"area_mu":{"type":"number","title":"Area Mu"},"report":{"additionalProperties":true,"type":"object","title":"Report"}},"type":"object","required":["project_id","task_id","output_dir","log_file","algo_name","file_name","area_mu","report"],"title":"OdmAlgoRep","description":"Model for ODM algorithm report."},"OdmGenRep":{"properties":{"project_id":{"type":"integer","title":"Project Id"},"task_id":{"type":"string","title":"Task Id"},"orthophoto_tif":{"type":"string","title":"Orthophoto Tif","default":"odm_orthophoto/odm_orthophoto.tif"}},"type":"object","required":["project_id","task_id"],"title":"OdmGenRep","description":"Model for ODM general report."},"OdmJob":{"properties":{"odm_project_id":{"type":"integer","title":"Odm Project Id"},"odm_task_id":{"type":"string","title":"Odm Task Id"},"odm_job_name":{"type":"string","title":"Odm Job Name"},"odm_job_type":{"$ref":"#/components/schemas/OdmType"},"odm_src_folder":{"type":"string","title":"Odm Src Folder"},"odm_samplinge_time":{"type":"string","format":"date-time","title":"Odm Samplinge Time"},"odm_host":{"type":"string","title":"Odm Host"},"odm_create_at":{"type":"string","format":"date-time","title":"Odm Create At"}},"type":"object","required":["odm_project_id","odm_task_id","odm_job_name","odm_job_type","odm_src_folder","odm_samplinge_time","odm_host","odm_create_at"],"title":"OdmJob","description":"Data model representing an ODM job configuration and metadata.\n\nThis model contains all necessary information to create and manage\nan ODM (OpenDroneMap) processing job."},"OdmState":{"properties":{"state":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"State"},"progress":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Progress","default":0.0},"error":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error"},"host":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Host"}},"type":"object","title":"OdmState"},"OdmType":{"type":"string","enum":["multispectral","rgb"],"title":"OdmType","description":"Enumeration of supported ODM image types."},"UploadRepTask":{"properties":{"project_id":{"type":"integer","title":"Project Id"},"task_id":{"type":"string","title":"Task Id"},"report_no":{"type":"string","title":"Report No"},"algo_name":{"type":"string","title":"Algo Name","default":"ndvi"}},"type":"object","required":["project_id","task_id","report_no"],"title":"UploadRepTask","description":"Model for ODM upload report task."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"},"Vdcm":{"properties":{"no":{"type":"string","maxLength":32,"minLength":1,"title":"No","description":"Unique record identifier"},"title":{"type":"string","maxLength":255,"minLength":1,"title":"Title","description":"Title of the job"},"job_type":{"$ref":"#/components/schemas/JobType","description":"Type of job - VIDEO or IMAGE"},"src_path":{"type":"string","maxLength":255,"minLength":1,"title":"Src Path","description":"Source path of the media file"},"frame_count":{"type":"integer","minimum":150.0,"title":"Frame Count","description":"Number of frames in the media file","default":150},"sample_number":{"type":"string","maxLength":16,"minLength":1,"title":"Sample Number","description":"Sample number identifier"},"sample_batch_number":{"type":"string","maxLength":16,"minLength":1,"title":"Sample Batch Number","description":"Batch number for sample group"},"taken_at":{"type":"string","format":"date","title":"Taken At","description":"Timestamp when media was captured"}},"type":"object","required":["job_type","src_path","sample_number","sample_batch_number"],"title":"Vdcm","description":"VDCM data model for handling video/image metadata"}}}}